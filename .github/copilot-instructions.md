# GOV.UK Prototype Kit - Copilot Rules

<!-- Generated by Copilot -->

## Project Overview
This project is a web application built using the GOV.UK Prototype Kit for rapid prototyping of user-centered services. The application is:
- Accessible and user-friendly
- Compliant with government standards
- Used for gathering user feedback and iterating on design concepts

## Technical Framework
- **Server-side**: Node.js and Express
- **Templating**: Nunjucks
- **UI Components**: GOV.UK Design System
- **Infrastructure**: Using Prototype Kit's built-in routing and templating features

## Folder Structure
```
[root]/
├── app/
│   ├── views/           # All templates
│   │   ├── layouts/     # Layout templates
│   │   ├── components/  # Reusable components
│   ├── routes.js        # Route definitions
```

## Code Standards

### Templates
- Use Nunjucks macros from GOV.UK Design System
- Always include macro imports at the top of templates:
  ```nunjucks
  {% from "govuk/components/input/macro.njk" import govukInput %}
  {% from "govuk/components/button/macro.njk" import govukButton %}
  ```

### User Data
- Persist user answers in `req.session`
- Display collected data on "Check your answers" pages

### Validation & Accessibility
- Return validation errors with `govukErrorSummary`
- Add per-field error items
- Meet WCAG 2.2 AA standards
- Follow Home Office accessibility poster guidance:
  - Appropriate colour contrast
  - Visible focus styles
  - Error feedback announced via `aria-live`
  - All inputs properly labelled

### Content Design
- Follow GOV.UK style guide:
  - Sentence case
  - ISO date format (e.g., "24 April 2025")
  - Plain English
  - No ampersands
  - Active voice
- Front-load key information
- One idea per sentence
- Address users directly using first person

### Code Organization
- Define and reuse Nunjucks filters (e.g., `toMonth`, `toMoney`)
- Separate data from presentation
- Add a comment `Generated by Copilot` to every Copilot-created file

### UI Components
Use GOV.UK Design System components for:
- Form elements (inputs, checkboxes, radio buttons)
- Error messages and validation feedback
- Success messages and confirmation screens
- Navigation elements including phase banners
- Information display (tables, lists, alerts)
- Progress indicators and loading states

## Version Management

Ringfence your prototype versions using date-based versioning:

1. Create new version folders named by date in the format `YYYY-MM-DD` (e.g., `2025-05-02`) in both:
   - `/app/views/versions/[date]`
   - `/app/routes/versions/[date]`
2. Each version should be a self-contained journey
3. Update the index page in app/views to reflect the new version with appropriate links and tags
4. Always link to the specific start point for each version (e.g., `/versions/2025-05-02/check/start`)
5. Use tags to indicate version status:
   - `govuk-tag--yellow` for "In progress"
   - `govuk-tag--green` for "Finished"

### Non-Date-Based Versions

For feature-based versions (rather than date-based):

1. Use descriptive names for the version folder (e.g., `multiple-sites`, `mvp`) in both:
   - `/app/views/versions/[feature-name]`
   - `/app/routes/versions/[feature-name]`
2. When copying from an existing version, be sure to update path references in route files by changing:
   ```javascript
   let version = "versions/original-name/";
   ```
   to:
   ```javascript
   let version = "versions/new-feature-name/";
   ```
3. Include in the index.html file following the same pattern as date-based versions

Example folder structure:
```
app/
  views/
    versions/
      2025-05-02/           # Date-based version
        check/
          start.html
      multiple-sites/       # Feature-based version
        check/
          start.html
  routes/
    versions/
      2025-05-02/           # Routes for date-based version
        check.js
      multiple-sites/       # Routes for feature-based version
        check.js
```

Example version index entry:
```nunjucks
{# In app/views/index.html #}
<!-- Start of iteration X -->
<strong class="govuk-tag govuk-tag--yellow" style="float:right">In progress</strong>
<h2 class="govuk-heading-m">Iteration X</h2>

<p><a href="versions/2025-05-02/check/start" class="govuk-link--no-visited-state">Start the iteration X journey</a></p>

<p>Brief description of what's new in this version.</p>

<details class="govuk-details govuk-!-margin-bottom-2">
  <summary class="govuk-details__summary">
    <span class="govuk-details__summary-text">
     The scenarios to follow for this iteration
    </span>
  </summary>
  <div class="govuk-details__text">
    <p>Scenario description here</p>
  </div>
</details>

<details class="govuk-details">
  <summary class="govuk-details__summary">
    <span class="govuk-details__summary-text">
      Internal shortcuts
    </span>
  </summary>
  <div class="govuk-details__text">
    <ul class="govuk-list govuk-list--spaced">
      <li><a href="versions/2025-05-02/check/exemption" class="govuk-link--no-visited-state">Exemption page</a></li>
      <!-- Other shortcuts -->
    </ul>
  </div>
</details>

<hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
<!-- End of iteration X -->
```

When creating a new version:
1. Copy the most recent version folder and rename it with the current date
2. Update corresponding route files with the same date structure
3. Update the index page to include the new version with appropriate links and status tag


<!-- Good practice setup -->

# Efficient Prototyping Practices with GOV.UK Prototype Kit

This guide outlines best practices for efficient prototyping based on Vicky Teinaki's approach. Use this as a reference when building prototypes to ensure consistency, maintainability, and effective user research.

## Layouts for Common Pages

Create reusable layouts for:

1. Service container pages (the main journey)
2. Guidance pages (help and information)
3. Email notifications (for testing email journeys)
4. SMS messages (for testing text message journeys)
5. Department specific footers
6. Accessibility statements
7. Cookie banners

Example folder structure:
```
app/
  views/
    layouts/
      main.html         # Standard GOV.UK layout
      guidance.html     # Layout for guidance pages
      email.html        # Layout for email templates
      sms.html          # Layout for SMS templates
```

## Custom Filters

Define reusable Nunjucks filters to separate data from presentation, for example:

```javascript
// In app/filters.js
module.exports = function (env) {
  // Convert number to money format
  env.addFilter('toMoney', function(amount) {
    return '£' + parseFloat(amount).toFixed(2)
  })
  
  // Convert month number to name
  env.addFilter('toMonth', function(monthNum) {
    const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                   'July', 'August', 'September', 'October', 'November', 'December']
    return months[monthNum - 1]
  })
}
```

## Reusable Components

Create components as you go to avoid duplication:

1. Identify repeating UI patterns
2. Extract them into components
3. Make them configurable with parameters

Example component structure:
```
app/
  views/
    components/
      task-list/
        _task-list.html
      application-summary/
        _application-summary.html
```

Example usage:
```nunjucks
{% from "components/task-list/_task-list.html" import taskList %}
{{ taskList({
  items: [
    {
      text: "Personal details",
      href: "personal-details",
      status: "Completed"
    },
    {
      text: "Contact details",
      href: "contact-details",
      status: "In progress"
    }
  ]
}) }}
```

## Complex Branching

For complex decision trees:

1. Use clear, semantic variable names
2. Create separate route files for complex journeys
3. Document decision points with comments
4. Use consistent conditionals

Example:
```javascript
// In routes/application.js
router.post('/eligibility-check', function (req, res) {
  // Store answers
  const age = req.session.data['applicant-age']
  const residency = req.session.data['uk-resident']
  const income = req.session.data['household-income']
  
  // Decision logic
  if (age < 18) {
    return res.redirect('not-eligible-age')
  }
  
  if (residency !== 'yes') {
    return res.redirect('not-eligible-residency')
  }
  
  if (income > 50000) {
    return res.redirect('not-eligible-income')
  }
  
  res.redirect('eligible')
})
```

## Implementation Tips

1. Use the GOV.UK Design System components consistently
2. Keep your prototype lean - don't implement more than necessary
3. Use clear, descriptive naming for files, routes, and variables
4. Comment your code, especially complex logic
5. Always include a prototype banner at the top of every page using the phase-banner component

Example prototype banner:
```nunjucks
{{ govukPhaseBanner({
  tag: {
    text: "Prototype"
  },
  html: 'This is a prototype. Do not use it for real services.'
}) }}
```


## Resources

- [GOV.UK Prototype Kit documentation](https://govuk-prototype-kit.herokuapp.com/docs)
- [GOV.UK Design System](https://design-system.service.gov.uk/)
- [Original blog post by Vicky Teinaki](https://www.vickyteinaki.com/blog/more-efficient-prototyping-with-the-gov-uk-prototype-kit-step-by-step/)

Generated by Copilot

