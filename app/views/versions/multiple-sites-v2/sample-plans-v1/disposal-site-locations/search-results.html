{% extends "../../layouts/exemption.html" %}

{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/pagination/macro.njk" import govukPagination %}
{% from "govuk/components/tag/macro.njk" import govukTag %}

{% block beforeContent %}
    {% include "../../includes/phase-banner.html" %}
    {% if data['user_type'] === 'organisation' %}
        {% include "../../includes/organisation-switcher.html" %}
    {% endif %}
    <a class="govuk-back-link" href="find-existing-disposal-site.html">Back</a>
{% endblock %}

<!-- Setting the big main heading at the top of the page -->
{% set pageHeadingTextHTML %}
Search results for disposal sites
{% endset %}

<!-- Text that show in the browser tab. Does NOT need changing -->
{% block pageTitle %}
    {{ pageHeadingTextHTML }} - {{ data['headerNameExemption'] }}
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        
        <span class="govuk-caption-l">{{ data['sample-plan-project-name-text-input'] }}</span>
        <h1 class="govuk-heading-l">
            {{ pageHeadingTextHTML }}
        </h1>

        {% set currentPage = data['page'] | int or 1 %}
        {% set totalResults = 53 %}
        {% set resultsPerPage = 20 %}
        {% set totalPages = (totalResults / resultsPerPage) | round(0, 'ceil') %}
        {% set startResult = ((currentPage - 1) * resultsPerPage) + 1 %}
        {% set endResult = currentPage * resultsPerPage %}
        {% if endResult > totalResults %}{% set endResult = totalResults %}{% endif %}

        <!-- Search criteria for filtering -->
        {% set searchCode = data['disposal-site-code'] or '' %}
        {% set searchName = data['disposal-site-name'] or '' %}
        {% set searchLocation = data['disposal-site-location'] or '' %}
        {% set searchMarineArea = data['marine-area'] or '' %}
        {% set searchStatus = data['disposal-site-status'] or '' %}
        {% set hasFilters = data['has-search-filters'] or false %}



        <p class="govuk-body" id="results-count">We found <strong id="total-results">{{ totalResults }}</strong> disposal sites matching your search criteria.</p>

        <!-- Search results table -->
        <div class="govuk-table-overflow">
            <table class="govuk-table" id="disposal-sites-table" data-module="moj-sortable-table">
                <caption class="govuk-table__caption govuk-visually-hidden">Disposal site search results</caption>
                <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header" aria-sort="ascending">Site code</th>
                        <th scope="col" class="govuk-table__header" aria-sort="none">Site name</th>
                        <th scope="col" class="govuk-table__header" aria-sort="none">Country</th>
                        <th scope="col" class="govuk-table__header" aria-sort="none">Sea area</th>
                        <th scope="col" class="govuk-table__header" aria-sort="none">Status</th>
                        <th scope="col" class="govuk-table__header">Action</th>
                    </tr>
                </thead>
                <tbody class="govuk-table__body" id="disposal-sites-table-body">
                    <!-- Table content will be populated by JavaScript -->
                </tbody>
            </table>
        </div>

        <p class="govuk-body govuk-!-margin-top-4" id="results-summary">Showing {{ startResult }} to {{ endResult }} of {{ totalResults }} results.</p>

        <nav class="govuk-pagination" aria-label="Pagination" id="pagination-nav">
            <!-- Pagination will be populated by JavaScript -->
        </nav>

        <p class="govuk-body govuk-!-margin-top-6">
            <a class="govuk-link govuk-link--no-visited-state" href="find-existing-disposal-site?disposal-site-code=&disposal-site-name=&disposal-site-location=&marine-area=&disposal-site-status=">Search for a different disposal site</a>
        </p>

        <div class="govuk-button-group govuk-!-margin-top-4">
            <a class="govuk-link govuk-link--no-visited-state" href="../sample-plan-start-page">Cancel and return to task list</a>
        </div>

    </div>
</div>

<!-- Pass search criteria to JavaScript -->
<script>
window.searchCriteria = {
    code: "{{ searchCode | safe }}",
    name: "{{ searchName | safe }}",
    location: "{{ searchLocation | safe }}",
    marineArea: "{{ searchMarineArea | safe }}",
    status: "{{ searchStatus | safe }}",
    hasFilters: {% if hasFilters %}true{% else %}false{% endif %}
};
</script>

{% endblock %}
